{% extends 'a2note/layout.html' %}
{% load static %}

{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

{% block title %}
  ninja dashboard
{% endblock %}

{% block SEOTitle %}
  <meta name="title" content="a2note.ninja - {% translate 'Your personal dashboard.' %}" />
{% endblock %}

{% block description %}
  <meta name="description" content="{% translate 'Here is your personal dashboard. You can see numbers and statistics about your activity on a2note.ninja.' %}" />
{% endblock %}


{% block body %}
  <div class="container my-container p-5">
    <button type="button" id="btnBackTop" class="btn btn-light btn-lg rounded-circle p-0 m-0" data-bs-toggle="tooltip" data-bs-placement="top" title="{% translate 'Back to top' %}"><span class="material-icons-outlined">keyboard_arrow_up</span></button>
    <h1 class="intro-0">{% translate 'Your personal dashboard' %}</h1>
    <h4 class="intro-1">{% translate "Here you can see some numbers and some statistics about your lists." %}</h4>

    <hr>

    <h3>{% translate "Report" %} <span class="material-icons-outlined">summarize</span></h3>

    {% if total > 0 %}
    <table class="table table-dark">
      <tr>
        <th class="table-active fs-5"><span class="material-icons-outlined">checklist_rtl</span> {% translate 'Todolists created' %}</th>
        <th class="table-active fs-5">{{ todolists_total }}</th>
      </tr>
      <tr>
        <th><span class="material-icons-outlined">tag</span> {% translate 'Tasks in to-do lists' %}</th>
        <td>{{ total_tasks }}</td>
      </tr>
      <tr>
        <th><span class="material-icons-outlined">check</span> {% translate 'Tasks done' %}</th>
        <td>{{ tasks_done }}</td>
      </tr>
      <tr>
        <th><span class="material-icons-outlined">pending</span> {% translate 'Tasks to do' %}</th>
        <td>{{ tasks_todo }}</td>
      </tr>
      <tr>
        <th class="table-active fs-5"><span class="material-icons-outlined">shopping_cart</span> {% translate 'Shopping lists created' %}</th>
        <th class="table-active fs-5">{{ shoplists_total }}</th>
      </tr>
      <tr>
        <th><span class="material-icons-outlined">add_shopping_cart</span> {% translate 'Items in shopping lists' %}</th>
        <td>{{ total_items }}</td>
      </tr>
      <tr>
        <th class="table-active fs-5"><span class="material-icons-outlined">functions</span> {% translate 'Total' %}</th>
        <th class="table-active fs-5">{{ total }}</th>
      </tr>
    </table>
    {% else %}
    <p><span class="material-icons-outlined">sentiment_dissatisfied</span> {% translate "Nothing to report here..." %}</p>
    {% endif %}

    <hr>

    <h3>{% translate "Statistics" %} <span class="material-icons-outlined">bar_chart</span></h3>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    {% if total > 0 %}
    <div class="row">
      {% if type_donut_plot %}
      <div class="col-lg-6 col-12 p-4">
        <h4>{% translate "Type of lists you make" %}</h4>
        <canvas class="position-relative" id="typeDonutPlot"></canvas>
        <script>

        function makeTypeDonutPlot() {
          let typeDonutPlot = {{ type_donut_plot|safe }};

          let data = {
            labels: typeDonutPlot["labels"],
            datasets: [{
              label: 'Tasks progress',
              backgroundColor: typeDonutPlot["colors"],
              data: typeDonutPlot["values"],
              hoverOffset: 4
            }],
          };

          let config = {
            type: 'doughnut',
            data,
            options: {
              cutout: "88%"
            }
          };

          let typeDonutPlotChart = new Chart(
            document.querySelector('#typeDonutPlot'),
            config
          );
        }

        setTimeout(() => {
          makeTypeDonutPlot();
        }, 150);


        </script>

      </div>
      {% endif %}

      {% if task_donut_plot %}
      <div class="col-lg-6 col-12 p-4">
        <h4>{% translate "Your overall progress with the tasks" %}</h4>
        <canvas class="position-relative" id="taskDonutPlot"></canvas>
        <script>

        function makeTaskDonutPlot() {
          let taskDonutPlot = {{ task_donut_plot|safe }};

          let data = {
            labels: taskDonutPlot["labels"],
            datasets: [{
              label: 'Tasks progress',
              backgroundColor: taskDonutPlot["colors"],
              data: taskDonutPlot["values"],
              hoverOffset: 4
            }],
          };

          let config = {
            type: 'doughnut',
            data,
            options: {
              cutout: "88%"
            }
          };

          let taskDonutPlotChart = new Chart(
            document.querySelector('#taskDonutPlot'),
            config
          );
        }

        setTimeout(() => {
          makeTaskDonutPlot();
        }, 350);

        </script>
      </div>
      {% endif %}

      {% if todo_weekday_plot  %}
      <div class="col-lg-6 col-12 p-1">
        <h4>{% translate "Your favourite days to make a to-do list" %}</h4>
        <canvas class="position-relative" id="todoPerWeekdayChart"></canvas>
          <script>

          function makeTodoWeekdayPlot() {
            let todoWeekdayPlot = {{ todo_weekday_plot|safe }};

            let data = {
              labels: todoWeekdayPlot["labels"],
              datasets: [{
                label: 'To-do lists',
                backgroundColor: todoWeekdayPlot["colors"],
                borderColor: todoWeekdayPlot["colors"],
                data: todoWeekdayPlot["values"],
                barPercentage: 0.7,
              }],
            };

            let config = {
              type: 'bar',
              data,
              options: {
                plugins: {
                  legend: {
                    display: false
                  }
                }
              }
            };

            let todoWeekdayPlotChart = new Chart(
              document.querySelector('#todoPerWeekdayChart'),
              config
            );
          }

          setTimeout(() => {
            makeTodoWeekdayPlot();
          }, 550);

          </script>
      </div>
      {% endif %}

      {% if shop_weekday_plot %}
      <div class="col-lg-6 col-12 p-1">
        <h4>{% translate "Your favourite days to make a shopping list" %}</h4>
        <div class="position-relative">
          <canvas class="position-relative" id="shopPerWeekdayChart"></canvas>
            <script>

            function makeShopWeekdayPlot() {
              let shopWeekdayPlot = {{ shop_weekday_plot|safe }};

              const data = {
                labels: shopWeekdayPlot["labels"],
                datasets: [{
                  label: 'Shopping lists',
                  backgroundColor: shopWeekdayPlot["colors"],
                  borderColor: shopWeekdayPlot["colors"],
                  data: shopWeekdayPlot["values"],
                  barPercentage: 0.7,
                }],
              };

              const config = {
                type: 'bar',
                data,
                options: {
                  plugins: {
                    legend: {
                      display: false
                    }
                  }
                }
              };

              let shopWeekdayPlotChart = new Chart(
                document.querySelector('#shopPerWeekdayChart'),
                config
              );
            }
            setTimeout(() => {
              makeShopWeekdayPlot();
            }, 750);

            </script>
        </div>
      </div>
      {% endif %}

      {% if shop_categories_plot %}
      <div class="w-100"></div>
      <div class="col-lg-6 col-12 p-1">
        <h4>{% translate "Your typical shopping" %}</h4>
        <div class="position-relative">
          <canvas class="position-relative" id="shopCategoriesChart"></canvas>
            <script>

            function makeShopCategoriesPlot() {
              let shopCategoriesPlot = {{ shop_categories_plot|safe }};

              const data = {
                labels: shopCategoriesPlot["labels"],
                datasets: [{
                  label: '',
                  backgroundColor: "rgba(255,0,0,0.4)",
                  borderColor: "rgb(255,0,0)",
                  pointBackgroundColor: 'rgb(255,0,0)',
                  pointBorderColor: 'rgb(255,0,0)',
                  pointHoverBackgroundColor: 'rgb(255,0,0)',
                  pointHoverBorderColor: 'rgb(255,0,0)',
                  data: shopCategoriesPlot["values"],
                  fill: true,
                }],
              };

              const config = {
                type: 'radar',
                data: data,
                options: {
                  elements: {
                    line: {
                      borderWidth: 3
                    }
                  },
                  scales: {
                    r: {
                      ticks: {
                        display: false,
                        maxTicksLimit: 5,
                      },
                      pointLabels: {
                        font: {
                          size: 15
                        }
                      }
                    },
                  },
                  plugins: {
                    legend: {
                      display: false
                    },
                    tooltip: {
                      enabled: false
                    }
                  }
                }
              };

              let shopCategoriesChart = new Chart(
                document.querySelector('#shopCategoriesChart'),
                config
              );
            }
            setTimeout(() => {
              makeShopCategoriesPlot();
            }, 950);

            </script>
        </div>
      </div>
      {% endif %}

    </div>
    {% else %}
    <p><span class="material-icons-outlined">not_interested</span> {% translate "You haven't created any list...yet" %}</p>
    {% endif %}

{% endblock %}
